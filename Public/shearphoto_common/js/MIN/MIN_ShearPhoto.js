window.ShearPhoto=function(){this.transform=this.DomMoveEve=this.DomUpEve=this.MoveDivEve=this.zoomEve=this.eveMold=!1,this.DivDownEVe={},this.transformFun(),!this.addevent&&window.addEventListener?(this.addevent="add",this.selectionempty=function(){window.getSelection().removeAllRanges()}):(this.addevent="att",this.selectionempty=function(){document.selection.empty()}),this.MyAjax=new window.ShearPhoto.MyAjax()},window.ShearPhoto.prototype={transformFun:function(){var f,e=document.body.style,d=new Array("MsTransform","MozTransform","WebkitTransform","WebkitTransform","OTransform","transform");for(f=0;f<d.length;f++){if(d[f] in e){this.transform=d[f];break}}},HTML5:{Reg:new RegExp("translate3d\\((.*?)\\)","i"),HTML5LT:function(b){b?(this.getLT=function(a){return domstyleTransform=this.Reg.exec(a.style[b]),domstyleTransform?domstyleTransform[1].split(",",2):[0,0]},this.setLT=function(a,p,o){var n=a.style,m=!0,l=n[b],k="translate3d("+p+","+o+",0)",j=l.replace(this.Reg,function(){return m=!1,k});n[b]=m?l+" "+k:j},this.setL=function(a,l){var k=a.style,j=!0,i=k[b],h=i.replace(this.Reg,function(e,c){j=!1;var f=c.split(",",2)[1];return"translate3d("+l+","+f+",0)"});k[b]=j?i+" translate3d("+l+",0,0)":h},this.setT=function(a,l){var k=a.style,j=!0,i=k[b],h=i.replace(this.Reg,function(e,c){j=!1;var f=c.split(",",2)[0];return"translate3d("+f+","+l+",0)"});k[b]=j?i+" translate3d(0,"+l+",0)":h}):(this.getLT=function(d){var c=d.style;return[c.left||0,c.top||0]},this.setLT=function(f,e,h){var g=f.style;g.left=e,g.top=h},this.setL=function(d,c){d.style.left=c},this.setT=function(d,c){d.style.top=c})},URL:window.URL||window.webkitURL||window.mozURL||window.msURL||!1,canvas:!1,Images:!1,ImagesType:"image/jpeg",HTML5PHP:!1,HTML5MAX:!1,HandleRotation:function(F,E,D,C,B,A,z,y){var v,u,t,s,r,x=F.ImgOHeight,w=F.ImgOWidth,o=[Math.ceil(w*A),Math.ceil(x*A)];switch(E){case 90:v=o[1],u=o[0],t=0,s=u;break;case 180:v=o[0],u=o[1],t=v,s=u;break;case 270:v=o[1],u=o[0],t=v,s=0}C.width=v,C.height=u,B.translate(t,s),B.rotate((360-E)*Math.PI/180),B.drawImage(F.arg.ImgMain,0,0,w,x,0,0,o[0],o[1]),r=B.getImageData(0,0,v,u),B.clearRect(0,0,o[0],o[1]),B.fillStyle="#FFFFFF",B.fillRect(0,0,o[0],o[1]),C.width=D.IW=z,C.height=D.IH=y,B.putImageData(r,-D.X*A,-D.Y*A),delete r},zipImg:function(h,g,l,k){var j=new Image(),i=this;j.onload=function(){var n,m,f,e,d,c,b=document.createElement("canvas");b.style.display="none",n=document.body,n.appendChild(b),m=b.getContext("2d"),f=this.width,e=this.height,g&&(d=f/e,f>g[0]&&(f=g[0],e=Math.round(g[0]/d)),e>g[0]&&(e=g[0],f=Math.round(g[0]*d),f>g[0]&&(f=g[0],e=Math.round(g[0]/d)))),b.width=f,b.height=e,m.fillStyle="#FFFFFF",m.fillRect(0,0,f,e),m.drawImage(j,0,0,this.width,this.height,0,0,f,e),c=b.toDataURL(l,g?g[1]:0.85),i.URL?(i.BOLBID&&i.URL.revokeObjectURL(i.BOLBID),i.BOLBID=i.URL.createObjectURL(i.FormBlob(c)),"function"==typeof k&&k(i.BOLBID)):"function"==typeof k&&k(c),m.clearRect(0,0,f,e),n.removeChild(b),delete c,delete j},j.src=h,delete h},CtxDrawImage:function(B,A,z,y){var v,u,t,s,r,q,p,o,x=A.R,w=y.arg;this.HTML5MAX?(v=A.IW,u=v,t=A.IH,s=v/t,v>this.HTML5MAX?(v=this.HTML5MAX,t=Math.round(v/s),t>this.HTML5MAX&&(t=this.HTML5MAX,v=Math.round(t*s))):t>this.HTML5MAX&&(t=this.HTML5MAX,v=Math.round(t*s),v>this.HTML5MAX&&(v=this.HTML5MAX,t=Math.round(v/s))),s=v/u,0===x?(r=y.ImgOWidth-A.X,q=y.ImgOHeight-A.Y,p=r*s,o=q*s,z.width=A.IW=v,z.height=A.IH=t,B.fillStyle="#FFFFFF",B.fillRect(0,0,p,o),B.drawImage(w.ImgMain,A.X,A.Y,r,q,0,0,p,o)):this.HandleRotation(y,x,A,z,B,s,v,t)):0===x?(z.width=A.IW,z.height=A.IH,B.fillStyle="#FFFFFF",B.fillRect(0,0,A.IW,A.IH),B.drawImage(w.ImgMain,-A.X,-A.Y)):this.HandleRotation(y,x,A,z,B,1,A.IW,A.IH)},lock:!1,PhotoHTML5True:!1,SetSrc:function(g,f,j,i){f.src=j.src=g;for(var h=0;h<i[1];h++){i[0][h].src=g}delete g},BOLBID:!1,Aclick:!1,artwork:!1,EffectsReturn:function(){this.Aclick&&(this.Aclick.className=""),this.Aclick=this.artwork,this.artwork&&(this.artwork.className="Aclick")},Effects:function(i,h){var l,n=this.arg.ImgMain,m=this.arg.ImgDom,k=this.preview,j=this;return function(){if(!h.lock){if(h.Aclick===this){return j.pointhandle(1500,1,"\u4eb2\uff01\u73b0\u5728\u5df2\u7ecf\u662f"+i+"\u6548\u679c\u4e86,\u5403\u9971\u996d\u6ca1\u4e8b\u5e72\u5417\uff1f",2,"#307ff6","#fff"),void 0}h.lock=!0,l=window.ShearPhoto.psLib(h.Images),h.Aclick&&(h.Aclick.className=""),h.Aclick=this,this.className="Aclick",j.pointhandle(0,1,"\u6b63\u5728\u52a0\u8f7d"+i+"\u6548\u679c\uff01\u7a0d\u7b49....\uff0c\u4e0d\u8981\u52a8\u9f20\u6807\uff0c\u53ef\u80fd\u6709\u70b9\u5361",2,"#fbeb61","#3a414c",function(){setTimeout(function(){var a,b=k.domimg;a="\u539f\u56fe"===i?l.save(!1,h.ImagesType):l.ps(i).save(!1,h.ImagesType),h.URL?(h.BOLBID&&h.URL.revokeObjectURL(h.BOLBID),h.BOLBID=h.URL.createObjectURL(h.FormBlob(a)),h.SetSrc(h.BOLBID,n,m,b)):h.SetSrc(a,n,m,b),delete a,j.pointhandle(1500,1,i+"\u6548\u679c\u52a0\u8f7d\u6210\u529f\uff01\u63d0\u793a\uff1a\u5982\u679c\u673a\u5668\u914d\u7f6e\u5dee\uff0c\u6548\u679c\u52a0\u8f7d\u65f6\u95f4\u4f1a\u66f4\u957f\u54e6",1,"#307ff6","#fff"),h.lock=!1,h.PhotoHTML5True=!0},1)})}}},BlobRegExp:new RegExp("^data:.*base64,"),FormBlob:function(i){var h,l,k,j,n=!1,m=i.replace(this.BlobRegExp,function(){return n=!0,""});for(h=n?atob(m):unescape(m),l=h.length,k=new Uint8Array(l),j=0;l>j;j++){k[j]=h.charCodeAt(j)}return new Blob([k],{type:this.ImagesType})},IfHTML5:function(f,e,h){try{new Blob(["1"],{type:"text/plain"})}catch(g){e=!1}f&&e&&(this.canvas=!0,this.HTML5MAX=h)},CanvasImg:function(r,q,p){var m,l,k,j,o=document.createElement("canvas"),n=document.body;if(o.style.display="none",n.appendChild(o),m=o.getContext("2d"),this.CtxDrawImage(m,r,o,p),l=this.FormBlob(o.toDataURL(this.ImagesType,p.arg.HTML5Quality)),m.clearRect(0,0,r.IW,r.IH),n.removeChild(o),k=new FormData(),k.append("ShearPhotoHTML5","True"),k.append("IW",r.IW),k.append("IH",r.IH),k.append("FW",r.FW),k.append("FH",r.FH),"[object Object]"===Object.prototype.toString.call(q)){for(j in q){k.append(j,q[j])}}return k.append("UpFile",l),k}},_ieexchange_:function(){function c(a,f){var e=new Array(d[a],d[f]);d[a]=e[1],d[f]=e[0]}var d=this;c("ImgWidth","ImgHeight")},SetRote:{ROReg:new RegExp("rotate\\((.*?)\\)","i"),SLReg:new RegExp("translate\\((.*?)\\)","i"),run:function(t,s,r,q){var p=t.style,o=!0,n=p[s],m=n.replace(this.ROReg,function(){return o=!1,r}),l=o?n+" "+r:m,o=!0,k=l.replace(this.SLReg,function(){return o=!1,q}),l=o?l+" "+q:k;return l},runSL:function(i,h,n){var m=i.style,l=!0,k=m[h],j=k.replace(this.SLReg,function(){return l=!1,n});return l?k+" "+n:j}},_exchange_:function(){var d,f,e=this;return this._ieexchange_(),d=this.rotate,90===d||270===d?(f={90:-1,270:1}[d],this.ImgRotateFun=function(a,j){var i=f*Math.round(0.5*(j-a))+"px",h=this.arg,c="translate("+i+","+i+")";return h.ImgMain.style[e.transform]=e.SetRote.runSL(h.ImgMain,e.transform,c),h.ImgDom.style[e.transform]=e.SetRote.runSL(h.ImgDom,e.transform,c),[j,a]},function(a,j,i){var h=f*Math.round(0.5*(e.ImgWidth-e.ImgHeight)),c="translate("+h+"px,"+h+"px)";return a.style[e.transform]=e.SetRote.run(a,e.transform,i,c),j.style[e.transform]=e.SetRote.run(j,e.transform,i,c),h}):(this.preview.WH=[e.ImgWidth,e.ImgHeight],this.ImgRotateFun=function(g,c){return[g,c]},function(a,h,g){return a.style[e.transform]=e.SetRote.run(a,e.transform,g,"translate(0,0)"),h.style[e.transform]=e.SetRote.run(h,e.transform,g,"translate(0,0)"),0})},preview:{isW:new Array(),isH:new Array(),run:function(Z,Y){var W,V,U,T,S,R,Q,P,O,N,M,H,G,F,D,C,B,A,L,K,J,I,E,X=this;if("[object Array]"===Object.prototype.toString.call(Z.preview)&&(W=Z.preview.length,V=function(){},U=Z.relativeUrl+"images/default.gif",W>0)){for(Z.scope.parentNode.insertAdjacentHTML("afterEnd",'<div id="preview" style="display:none;margin-left:8px;"></div>'),T="",S=V,R=!1,Z.proportional[0]?R=Z.proportional[0]:S=function(f,e,h,g){f[1][h].style.height=Math.round(e[h]/g[0]*g[1])+"px"},Q=10,P=5,O=Q+2*P,N=0;W>N;N++){this.domWidth+=Z.preview[N]+O,M=R?Math.round(Z.preview[N]/R)+"px;":"auto;",T+='<a href="javascript:;" style="width:'+Z.preview[N]+"px;height:"+M+"margin-right:"+Q+"px;background-color: #F5F5F5;border: "+P+'px solid #F5F5F5;"><img src="'+U+'"/></a>'}this.dom=document.getElementById("preview"),this.dom.innerHTML=T,this.dom.parentNode.style.width=Z.scopeWidth+2+"px",L=[this.dom.getElementsByTagName("img"),this.dom.getElementsByTagName("a")],K=function(d,c){d.src=c},J=function(b,p,o,n){var c,m=Math.round(p[0]*o),l=Math.round(p[1]*o),k=!1;X.isW[n]===m||(b.style.width=m+"px",X.isW[n]=m,k=!0),X.isH[n]===l||(b.style.height=l+"px",X.isH[n]=l,k=!0),k&&Y.rotate>10&&180!==Y.rotate&&(c=(X.isW[n]-X.isH[n])/(270===Y.rotate?-2:2)+"px",b.style[Y.transform]=Y.SetRote.runSL(b,Y.transform,"translate("+c+","+c+")"))},I=function(b,j,i,h){if(Y.transform){var g=i[1]*h+"px";b.style[j]=Y.SetRote.run(b,j,i[0],"translate("+g+","+g+")")}else{b.style[j]=i}},E=L[0],this.domimg=[L[0],W],this.close_=function(){for(var a=0;W>a;a++){A=E[a],A.src=U,"cssText" in A.style?A.style.cssText="":A.setAttribute("style","")}this.dom.style.display="none",Z.Effects&&(Z.Effects.style.display="none"),this.dom.parentNode.style.width=Z.scopeWidth+2+"px"},this.handle=function(x,w,v,u){var t,s,r,q,p,o,h,e,d,a;for(w&&this.open_(u||Z,v),t=x.left,s=x.top,r=x.formAllW,q=x.imgUrl,p=x.TF,o=x.styleR,h=x.R,e=x.formAllH,d=x.HTML3D,H="boolean"==typeof q?V:K,G=p?J:V,F="boolean"==typeof h?V:I,"boolean"==typeof t?t=V:(C=t+Z.Border,B=s+Z.Border,t=function(b){d.setLT(A,C*b+"px",B*b+"px")}),a=0;W>a;a++){A=E[a],D=Z.preview[a]/r,t(D),S(L,Z.preview,a,[r,e]),H(A,q),G(A,this.WH,D,a),F(A,o,h,D)}}}},dom:!1,domWidth:0,domimg:!1,WH:new Array(2),parentNodes:!1,EffTrue:!1,handle:function(e,d,f){d&&this.open_(f)},close_:function(){this.arg.Effects&&(this.arg.Effects.style.display="none"),this.parentNodes&&(this.parentNodes.style.width=this.arg.scopeWidth+2+"px")},open_:function(d){var c=0;this.arg=d,this.EffTrue?(d.Effects.style.display="block",d.Effects.scrollTop=0,d.Effects.style.height=d.scopeHeight+"px",this.parentNodes=d.Effects.parentNode,c=d.Effects.offsetWidth):d.Effects&&(d.Effects.parentNode.removeChild(d.Effects),d.Effects=!1),this.dom?(this.dom.style.display="block",this.dom.parentNode.style.width=d.scopeWidth+this.domWidth+c+10+"px"):d.Effects&&(d.Effects.parentNode.style.width=d.scopeWidth+this.domWidth+c+2+"px")}},Rotate:function(f){var e,h,g;this.transform?("left"===f?this.rotate-=90:this.rotate+=90,this.rotate={"-90":270,0:0,"-270":90,360:0,180:180,90:90,270:270,"-360":0,"-180":180}[this.rotate]||0,e="rotate("+this.rotate+"deg)",h=this._exchange_(),this.setinitial(this.arg,!0),g=h(this.arg.ImgMain,this.arg.ImgDom,e),this.preview.handle({left:this.ImgDomL,top:this.ImgDomT,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:!1,styleR:this.transform,R:[e,g],HTML3D:this.HTML5})):("left"===f?this.rotate-=1:this.rotate+=1,this.rotate=this.rotate>3?0:this.rotate<0?3:this.rotate,this.ImgRotateFun=1===this.rotate||3===this.rotate?function(d,c){return[c,d]}:function(d,c){return[d,c]},this.arg.ImgMain.style.filter=this.arg.ImgDom.style.filter=e="progid:DXImageTransform.Microsoft.BasicImage(rotation="+this.rotate+")",this._ieexchange_(),this.preview.handle({left:!1,top:!1,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:!1,styleR:"filter",R:e,HTML3D:this.HTML5}),this.setinitial(this.arg,!0))},pointhandle:function(z,y,x,w,v,u,t){function o(a,j,i,h){if(a+=h,a>j&&h>0){return p.setT(s,j+"px"),z?setTimeout(function(){o(j,q,i,-1)},z):"function"==typeof t&&t(),void 0}if(j>a&&0>h){try{r.arg.scope.removeChild(s)}catch(g){}}else{p.setT(s,a+"px"),setTimeout(function(){o(a,j,i,h)},i)}}var r,q,p,n,s=this.arg.scope.children[0];if("point"===s.className&&this.arg.scope.removeChild(s),-1!==z){switch(s=document.createElement("div"),s.className="point",this.arg.scope.insertBefore(s,this.arg.scope.childNodes[0]),r=this,q=-35,p=this.HTML5,s.style.color=u,s.style.backgroundColor=v,s.innerHTML="<i></i>"+x,n=s.getElementsByTagName("i")[0],w){case 0:n.style.backgroundPosition="-16px 0";break;case 1:n.style.backgroundPosition="0 0";break;case 2:n.style.backgroundPosition="-31px 0"}o(q,0,y,1)}},setinitial:function(x,w){var r,q,p,o,n,m,v=0,u=0,t=!x.traverse,s=this.HTML5;this.BoxW>this.ImgWidth?(this.relatW=this.ImgWidth,x.relat.style.width=this.ImgWidth+"px",n=Math.round(0.5*(this.BoxW-this.ImgWidth)),r=(this.relatL=n)+"px",q=-n+"px"):(x.relat.style.width=this.BoxW+"px",this.relatW=this.BoxW,r=q=this.relatL=0,t&&(v=(this.BoxW-this.ImgWidth)/2)),this.BoxH>this.ImgHeight?(this.relatH=this.ImgHeight,x.relat.style.height=this.ImgHeight+"px",m=Math.round(0.5*(this.BoxH-this.ImgHeight)),this.relatT=m,p=m+"px",o=-m+"px"):(this.relatH=this.BoxH,x.relat.style.height=this.BoxH+"px",p=o=this.relatT=0,t&&(u=(this.BoxH-this.ImgHeight)/2)),s.setLT(x.relat,r,p),s.setLT(x.black,q,o),this.AmendOffset(),this.MovePhoto(w,v,u,t)},MovePhoto:function(J,I,H,G){var C,B,A,z,y,x,v,u,t,s,F=this.arg,E=F.ImgDom,D=F.ImgMain,w=this.HTML5;F.traverse&&this.BoxW<this.ImgWidth?(v=this.ImgWidth-this.BoxW,C=this.BoxW-this.formAllW,B=C&&v/C,u=Math.round(-this.formLeft*B),A=u,y=u-this.formLeft-this.Border):(A=I=F.traverse?0:G?I:this.ImgMainL,y=I-this.formLeft-this.Border),F.traverse&&this.BoxH<this.ImgHeight?(t=this.ImgHeight-this.BoxH,C=this.BoxH-this.formAllH,B=C&&t/C,s=Math.round(-this.formTop*B),z=s,x=s-this.formTop-this.Border):(z=H=F.traverse?0:G?H:this.ImgMainT,x=H-this.formTop-this.Border),this.ImgMainT=z,this.ImgMainL=A,this.ImgDomL=y,this.ImgDomT=x,w.setLT(D,A+"px",z+"px"),w.setLT(E,y+"px",x+"px"),this.preview.handle({left:y,top:x,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:!1,TF:J,styleR:!1,R:!1,HTML3D:w})},AmendOffset:function(){var p,o,n,m,l,k,j,r=this.HTML5,q=r.getLT(this.formParent);"boolean"==typeof this.formLeft&&(this.formLeft=parseFloat(q[0])),"boolean"==typeof this.formTop&&(this.formTop=parseFloat(q[1])),this.saveL?(this.formLeft=this.saveL-this.relatL,this.formTop=this.saveT-this.relatT):(this.formLeft-=this.relatL,this.formTop-=this.relatT),this.formLeft<0&&(this.formLeft=0,this.saveL=this.relatL),this.formTop<0&&(this.formTop=0,this.saveT=this.relatT),r.setLT(this.formParent,this.formLeft+"px",this.formTop+"px"),p=this.formLeft+this.formAllW,o=this.formTop+this.formAllH,n=!1,m=!1,p>this.relatW&&(l=p-this.relatW,l>this.formLeft?(this.formW=this.formW-(l-this.formLeft),this.formLeft=0,n="0px",this.saveL=this.relatL,this.formAllW=this.formW+this.Mdouble):(this.formLeft-=l,n=this.formLeft+"px",this.saveL=this.formLeft+this.relatL)),o>this.relatH&&(k=o-this.relatH,k>this.formTop?(this.formH=this.formH-(k-this.formTop),this.formTop=0,m="0px",this.saveT=this.relatT,this.formAllH=this.formH+this.Mdouble):(this.formTop=this.formTop-k,m=this.formTop+"px",this.saveT=this.formTop+this.relatT)),n&&m?r.setLT(this.formParent,n,m):n?r.setL(this.formParent,n):m&&r.setT(this.formParent,m),this.arg.proportional[0]&&(j=Math.round(this.formAllW/this.arg.proportional[0]),j>this.formAllH?(this.formAllW=Math.round(this.formAllH*this.arg.proportional[0]),this.formW=this.formAllW-this.Mdouble):(this.formAllH=j,this.formH=j-this.Mdouble)),this.arg.form.style.width=this.formW+"px",this.arg.form.style.height=this.formH+"px",this.ie6(this.formParent,this.formAllW,this.formAllH)},MaxMinLimit:function(e){e.ImgWidth=e.ImgOWidth=this.width,e.ImgHeight=e.ImgOHeight=this.height,"number"==typeof e.arg.Max&&(e.ImgWidth>e.arg.Max&&(e.ImgWidth=e.arg.Max,e.ImgHeight=Math.round(e.ImgWidth/e.ImgScales)),e.ImgHeight>e.arg.Max&&(e.ImgHeight=e.arg.Max,e.ImgWidth=Math.round(e.ImgHeight*e.ImgScales)));var d,f;e.arg.proportional[0]?(d=e.Min,f=Math.round(d*e.arg.proportional[0]),f<e.Min&&(f=e.Min,d=Math.round(f/e.arg.proportional[0]))):f=d=e.Min,e.ImgWidth<f&&(e.ImgWidth=f,e.ImgHeight=Math.round(e.ImgWidth/e.ImgScales)),e.ImgHeight<d&&(e.ImgHeight=d,e.ImgWidth=Math.round(e.ImgHeight*e.ImgScales)),e.artworkW=e.ImgWidth,e.artworkH=e.ImgHeight},run:function(h,g){this.HTML5.HTML5PHP=g;var l=this,k=this.arg,j=this.HTML5.canvas&&g?h:k.relativeUrl+h,i=this.HTML5.Images=new Image();this.defaultShear(),this.arg=k,this.HTML5.canvas&&g||(this.ImgUrl=h),i.onload=function(){var a,d,c;return !(this.width=Math.round(this.width))>0||!(this.height=Math.round(this.height))>0?(l.pointhandle(3000,10,"\u8bf7\u9009\u62e9\u6b63\u786e\u56fe\u7247",0,"#f82373","#fff"),void 0):(k.ImgMain.src=k.ImgDom.src=j,k.black.style.zIndex=99,l.ImgScales=this.width/this.height,l.Min=k.Min,l.MaxMinLimit.call(this,l),k.ImgMain.style.width=k.ImgDom.style.width=l.artworkW+"px",k.ImgMain.style.height=k.ImgDom.style.height=l.artworkH+"px",l.BoxW=k.scope.offsetWidth-2,l.BoxH=k.scope.offsetHeight-2,l.Border=k.Border,l.Mdouble=2*k.Border,k.proportional[0]?(a=k.proportional[1]-l.Mdouble,d=k.proportional[1]/k.proportional[0]-l.Mdouble):(a=k.proportional[1]-l.Mdouble,d=k.proportional[2]-l.Mdouble),l.formW=a=Math.round(a),l.formH=d=Math.round(d),l.formAllW=a+l.Mdouble,l.formAllH=d+l.Mdouble,l.preview.WH=[l.artworkW,l.artworkH],l.formParent=k.form.offsetParent,l.et(),l.setinitial(k),l.preview.handle({left:!1,top:!1,formAllW:l.formAllW,formAllH:l.formAllH,TF:!0,imgUrl:j,styleR:!1,R:!1,HTML3D:l.HTML5},!0,k),c=l.MoveDiv=new window.ShearPhoto.MoveDiv(),c.reckon(k.relat,!1),c.selectionempty=l.selectionempty,c.addevent=l.addevent,c.HTML5=l.HTML5,c.run({to:new Array(k.form),form:l.formParent,MoveWidth:l.relatW,MoveHeight:l.relatH,shifting:new Array(),center:1,centerFront:function(){return[l.relatW,l.relatH]},DivDownFun:function(b){b.arg.MoveWidth=l.relatW,b.arg.MoveHeight=l.relatH,b.DivW=l.formW+l.Mdouble,b.DivH=l.formH+l.Mdouble},centerfun:function(f,e,m){l.formLeft=f,l.formTop=e,l.MovePhoto(!1,0,0),m.arg.MoveWidth=l.relatW,m.arg.MoveHeight=l.relatH,m.DivW=l.formW+l.Mdouble,m.DivH=l.formH+l.Mdouble},zIndex:100,MoveFun:function(f,e){l.formLeft=f,l.formTop=e,l.MovePhoto(!0,0,0)}}),l.MoveDivEve=function(){c.delDownEve()},k.Shearbar.style.display="block",k.SelectBox.style.visibility="hidden",l.zoom(),l.pointhandle(2000,10,"\u53ef\u4ee5\u62d6\u52a8\u6216\u62c9\u4f38\u84dd\u8fb9\u6846\u8fdb\u884c\u622a\u56fe",1,"#fbeb61","#3a414c"),delete j,delete h,void 0)},i.onerror=function(){l.pointhandle(0,10,"\u65e0\u6cd5\u8bfb\u53d6\u56fe\u7247\u3002\u56fe\u7247\u7c7b\u578b\u6216\u8def\u5f84\u4e0d\u6b63\u786e \u6216 relativeUrl\u53c2\u6570\u662f\u5426\u5b58\u5728\u95ee\u9898",0,"#f82373","#fff")},this.pointhandle(0,1,"\u56fe\u7247\u5df2\u52a0\u8f7d\uff0c\u6b63\u5728\u521b\u5efa\u622a\u56fe\u73af\u5883\uff0c\u8bf7\u7a0d\u7b49........",2,"#fbeb61","#3a414c",function(){i.src=j})},config:function(j){var i,p,o,m,n,l,k;if(this.arg=j,j.Shearbar.style.display="none",j.scope.style.width=j.black.style.width=j.SelectBox.style.width=j.scopeWidth+"px",j.scope.style.height=j.black.style.height=j.SelectBox.style.height=j.scopeHeight+"px",i=j.scope.parentNode,i.style.width=i.parentNode.style.width=j.scopeWidth+2+"px",this.HTML5.IfHTML5(this.transform,j.HTML5,j.HTML5MAX),this.HTML5.HTML5LT(j.translate3d&&this.transform),p=this.transform?function(d,c){d.style.opacity=c}:function(d,c){d.style.filter="alpha(opacity="+100*c+")"},j.Border>0){j.DynamicBorder[0].style.display=j.DynamicBorder[1].style.display=j.DynamicBorder[2].style.display=j.DynamicBorder[3].style.display="none",j.DynamicBorder[0].style.background=j.DynamicBorder[1].style.background=j.DynamicBorder[2].style.background=j.DynamicBorder[3].style.background="#FFF";for(o in j.to){j.to[o].style.border="1px solid "+j.BorderColor,j.to[o].style.background=j.BorderColor,p(j.to[o],1)}j.form.style.border=j.Border+"px  "+j.BorderStyle+"  "+j.BorderColor}if(j.black.style.background=j.backgroundColor,p(j.black,j.backgroundOpacity),this.preview.run(j,this),j.scope.ondragstart=function(){return !1},this.ie6=navigator.userAgent.indexOf("MSIE 6.0")>0&&0===j.Border?function(a,f,e){a.style.height=j.DynamicBorder[1].style.height=j.DynamicBorder[2].style.height=e+"px",a.style.width=f+"px"}:function(){},this.preview.EffTrue=j.HTML5Effects&&this.HTML5.canvas&&j.Effects){for(n=j.Effects.getElementsByTagName("a"),l=this.HTML5.Effects,this.HTML5.artwork=this.HTML5.Aclick=n[0],k=0;k<n.length;k++){m=n[k],m.onclick=l.call(this,m.getAttribute("StrEvent"),this.HTML5)}}this.pointhandle(3000,10,"\u8bf7\u9009\u62e9\u672c\u5730\u7167\u7247\u3001\u76f8\u518c\u3001\u62cd\u7167\uff0c\u8fdb\u884c\u622a\u53d6\u5934\u50cf",2,"#307ff6","#fff")},zoom:function(){var o,n,p,m,l,k,j,r=this,q=new window.ShearPhoto.MoveDiv();q.reckon(r.arg.ZoomDist,!1),q.selectionempty=r.selectionempty,q.addevent=r.addevent,q.HTML5=this.HTML5,p=r.arg.ZoomBar,r.arg.proportional[0]?(o=r.Min,n=Math.round(o*r.arg.proportional[0]),n<r.Min&&(n=r.Min,o=Math.round(n/r.arg.proportional[0]))):n=o=r.Min,q.run({to:[p],form:p,MoveWidth:q.ReckonWH.W,MoveHeight:q.ReckonWH.H,shifting:new Array(),center:1,zIndex:100,DivDownFun:function(){r.saveL=r.formLeft+r.relatL,r.saveT=r.formTop+r.relatT},cursor:"pointer",MoveFun:function(a){var h,g,e,d;h=l>a?Math.round(j*a+10)/100:Math.round(a*k-100)/100,g=Math.round(r.artworkW*h),e=Math.round(r.artworkH*h),n>g&&(g=n,e=Math.round(g/r.ImgScales)),o>e&&(e=o,g=Math.round(e*r.ImgScales)),d=r.ImgRotateFun(g,e),r.ImgWidth=d[0],r.ImgHeight=d[1],r.arg.ImgMain.style.width=r.arg.ImgDom.style.width=g+"px",r.arg.ImgMain.style.height=r.arg.ImgDom.style.height=e+"px",r.preview.WH=[g,e],r.setinitial(r.arg,!0)}}),r.zoomEve=function(){q.delDownEve()},m=q.ReckonWH.W-q.DivW,l=0.5*m,k=200/l,j=90/l},PointerShape:function(b){this.arg.scope.style.cursor=this.arg.form.style.cursor=b},DelPointerShape:function(){this.arg.scope.style.cursor="",this.arg.form.style.cursor="move"},ShearPhotoDown:function(d,c){this.addEvent(d,"mousedown",c),this.addEvent(d,"touchstart",c)},delShearPhotoDown:function(d,c){this.delEvent(d,"mousedown",c),this.delEvent(d,"touchstart",c)},et:function(){for(var b in this.arg.to){"add"===this.addevent?("function"!=typeof this.DivDownEVe[b]?this.DivDownEVe[b]=this.DivDown(b):this.delShearPhotoDown(this.arg.to[b],this.DivDownEVe[b]),this.ShearPhotoDown(this.arg.to[b],this.DivDownEVe[b])):this.arg.to[b].onmousedown=this.DivDown(b)}},addEvent:function(f,e,h){var g={add:function(){f.addEventListener(e,h,!1)},att:function(){f.attachEvent("on"+e,h)}};g[this.addevent]&&g[this.addevent]()},delEvent:function(f,e,h){var g={add:function(){f.removeEventListener(e,h,!1)},att:function(){f.detachEvent("on"+e,h)}};g[this.addevent]&&g[this.addevent]()},DomUp:function(d){var c=this;return function(){return"function"==typeof c.arg.UpFun&&c.arg.UpFun(),d.releaseCapture&&d.releaseCapture(),c.DelPointerShape(),"function"==typeof c.DomMoveEve&&c.delEvent(document,c.eveMold[1],c.DomMoveEve),"function"==typeof c.DomUpEve&&(c.delEvent(document,c.eveMold[2],c.DomUpEve),c.delEvent(window,c.eveMold[2],c.DomUpEve),c.delEvent(window,"blur",c.DomUpEve),c.delEvent(d,"losecapture",c.DomUpEve)),!1}},setWHfalse:function(h,g,l,k,j,i){return g>j&&(g=j),l>i&&(l=i),g<this.Min&&(g=this.Min),l<this.Min&&(l=this.Min),[g,l]},setWfalse:function(g,f,j,i,h){return f>h&&(f=h),f<this.Min&&(f=this.Min),[f,this.formAllH]},setHfalse:function(h,g,l,k,j,i){return l>i&&(l=i),l<this.Min&&(l=this.Min),[this.formAllW,l]},CycleCalculation:function(g,f,j,i,h){return f>h?(f=h,g=Math.round(f*j),this.CycleCalculation.apply(this,arguments)):g>i?(g=i,f=Math.round(g/j),this.CycleCalculation.apply(this,arguments)):f<this.Min?(f=this.Min,g=Math.round(f*j),this.CycleCalculation.apply(this,arguments)):g<this.Min?(g=this.Min,f=Math.round(g/j),this.CycleCalculation.apply(this,arguments)):[g,f]},setHtrue:function(h,g,l,k,j,i){return g=Math.round(l*k),this.CycleCalculation(g,l,k,j,i)},setWtrue:function(h,g,l,k,j,i){return l=Math.round(g/k),this.CycleCalculation(g,l,k,j,i)},amend:function(x,w,v,u,t){var q,p,s=x-this.formAllW,r=w-this.formAllH,o=this,k=this.HTML5,j={LL:function(){q=Math.round(o.formLeft-s),o.formLeft=q,k.setL(v,q+"px")},TT:function(){p=Math.round(o.formTop-r),o.formTop=p,k.setT(v,p+"px")},ML:function(){s*=0.5,q=o.formLeft-s,o.formLeft=q,k.setL(v,q+"px")},MT:function(){r*=0.5,p=o.formTop-r,o.formTop=p,k.setT(v,p+"px")},NO:function(){}};j[u](),j[t]()},DomMove:function(H,G,F,E,D,C,B,A,z,y,x){var w,v,u,t,s,r;return H.arg.ImgMain,H.arg.ImgDom,"function"==typeof H.DomUpEve&&(H.delEvent(document,H.eveMold[2],H.DomUpEve),H.delEvent(window,H.eveMold[2],H.DomUpEve),H.delEvent(window,"blur",H.DomUpEve),H.delEvent(G,"losecapture",H.DomUpEve)),H.DomUpEve=H.DomUp(G),H.addEvent(document,H.eveMold[2],H.DomUpEve),H.addEvent(window,H.eveMold[2],H.DomUpEve),H.addEvent(window,"blur",H.DomUpEve),H.addEvent(G,"losecapture",H.DomUpEve),function(a){return a=a||window.event,a.button>1?(H.DomUp(this)(),!1):(w=H.eveMold[3](a,"clientX"),v=H.eveMold[3](a,"clientY"),r=H.arg.form,setTimeout(function(){t=D*(w-F),s=C*(v-E),H.selectionempty(),u=H.drawfun(r,t,s,H.arg.proportional[0],A,z),t=u[0],s=u[1],H.amend(t,s,B,y,x),H.formAllW=t,H.formAllH=s,t=H.formW=t-H.Mdouble,s=H.formH=s-H.Mdouble,r.style.width=t+"px",r.style.height=s+"px",H.ie6(B,t,s),H.MovePhoto(!0,0,0)},1),!1)}},defaultShear:function(){this.arg.Shearbar.style.display="none","function"==typeof this.MoveDivEve&&this.MoveDivEve(),"function"==typeof this.zoomEve&&this.zoomEve(),"cssText" in this.arg.ImgMain.style?this.arg.ImgMain.style.cssText=this.arg.ImgDom.style.cssText="":(this.arg.ImgMain.setAttribute("style",""),this.arg.ImgDom.setAttribute("style","")),this.arg=this.ImgUrl=this.formW=this.formH=this.formAllW=this.formAllH=this.drawfun=this.formParent=this.ImgWidth=this.ImgHeight=this.artworkW=this.artworkH=this.BoxW=this.BoxH=this.Border=this.Mdouble=this.ImgScales=this.Min=this.formLeft=this.formTop=this.relatL=this.relatT=this.relatW=this.relatH=this.saveL=this.ImgOWidth=this.ImgOHeight=this.saveT=this.HTML5.lock=this.HTML5.PhotoHTML5True=!1,this.rotate=this.ImgMainT=this.ImgDomT=this.ImgMainL=this.ImgDomL=0,this.preview.isW=[],this.preview.isH=[],this.ImgRotateFun=function(d,c){return[d,c]}},SendUserMsg:function(i,h,n,m,l,k,j){this.arg.black.style.zIndex=k?199:99,this.pointhandle(h,10,i,n,m,l),this.arg.Shearbar.style.display=j?"none":"block"},again:function(){this.arg.SelectBox.style.visibility="visible",this.arg.Shearbar.style.display="none",this.arg.ImgDom.src=this.arg.ImgMain.src=this.arg.relativeUrl+"images/default.gif"},CoordinateData:function(t){var q,p,o,n,m,l,k,s=function(e,d,f){return 1>e&&(e=1,d=Math.round(1/f)),1>d&&(d=1,e=Math.round(f)),[e,d]},r={};return t||(r.url="../"+this.ImgUrl),q={1:270,2:180,3:90,90:270,180:180,270:90}[this.rotate]||(q=this.rotate),p=this.ImgWidth,o=this.ImgHeight,n={0:p,90:o,180:p,270:o},m=this.ImgOWidth/n[q],r.R=q,r.X=Math.round((Math.abs(this.ImgDomL)-this.Border)*m),r.Y=Math.round((Math.abs(this.ImgDomT)-this.Border)*m),r.P=this.arg.proportional[0],l=this.formAllW/this.formAllH,k=s(Math.round(this.formAllW*m),Math.round(this.formAllH*m),l),r.IW=k[0],r.IH=k[1],k=s(this.formAllW,this.formAllH,l),r.FW=k[0],r.FH=k[1],r},SendPHP:function(j){var p,n,i,o,l,k;if(this.SendUserMsg("\u6b63\u5728\u4e3a\u4f60\u5904\u7406\u622a\u56fe\uff0c\u7a0d\u7b49...",0,2,"#fbeb61","#3a414c",!0,!0),i=this,o=this.HTML5,(o.HTML5PHP||o.PhotoHTML5True)&&o.canvas){try{o.BOLBID&&o.URL.revokeObjectURL(o.BOLBID),p=this.CoordinateData(!0),n=o.CanvasImg(p,j,this)}catch(m){return i.SendUserMsg("\u9519\u8bef\uff1a\u5207\u5272\u56fe\u7247\u65f6\u4e25\u91cd\u62a5\u9519,\u8bf7\u66f4\u6362\u6d4f\u89c8\u5668\u8bd5\u8bd5\uff0c\u6216\u8005\u6362\u5f20\u56fe\u7247",5000,0,"#f4102b","#fff",!1),void 0}}else{if(l="","[object Object]"===Object.prototype.toString.call(j)){for(k in j){l+="&"+k+"="+j[k]}}p=this.CoordinateData(),n="JSdate="+window.ShearPhoto.JsonString.JsonToString(p)+l}this.MyAjax.carry({url:i.arg.url,data:n,type:"POST",timeout:10000,async:!0,lock:!0,complete:!1,success:function(b){return b=window.ShearPhoto.JsonString.StringToJson(b),b===!1?(i.SendUserMsg("\u9519\u8bef\uff1a\u8bf7\u4fdd\u8bc1\u540e\u7aef\u73af\u5883\u8fd0\u884c\u6b63\u5e38",5000,0,"#f4102b","#fff",!1),void 0):b.erro?(i.SendUserMsg("\u9519\u8bef\uff1a"+b.erro,5000,0,"#f4102b","#fff",!1),void 0):("function"==typeof i.complete&&i.complete(b),delete i.HTML5.Images,void 0)},error:function(){i.SendUserMsg("\u9519\u8bef\uff1a\u8fde\u63a5\u540e\u7aef\u5931\u8d25\uff0c\u53ef\u80fd\u539f\u56e0\uff0c\u8d85\u65f6\uff01\u6216\u8005\u540e\u7aef\u73af\u5883\u65e0\u6cd5\u8fd0\u884c",5000,0,"#f4102b","#fff",!1)},cache:!1})},DivDown:function(z){var t,s,r,q,p,o,n,y=this,x=1,w=1,v="NO",u="NO";return function(e){var b,a,d,c,k,j,i,h,g,f;if(e=e||window.event,d=e.button,c=typeof d,e.preventDefault&&e.preventDefault(),"number"!==c?(y.eveMold=["touchstart","touchmove","touchend",function(m,l){return m.touches[0][l]}],b=e.touches[0].clientX,a=e.touches[0].clientY):(y.eveMold=["mousedown","mousemove","mouseup",function(m,l){return m[l]}],b=e.clientX,a=e.clientY),2>d||"number"!==c){switch(r=y.formAllW,q=y.formAllH,o=y.formParent,p=y.formLeft,n=y.formTop,z){case"BottomRight":t=y.relatW-p,s=y.relatH-n,y.drawfun=y.arg.proportional[0]?y.setHtrue:y.setWHfalse,y.PointerShape("nw-resize");break;case"TopRight":w=-1,u="TT",t=y.relatW-p,s=n+y.formAllH,y.drawfun=y.arg.proportional[0]?y.setHtrue:y.setWHfalse,y.PointerShape("ne-resize");break;case"Bottomleft":x=-1,v="LL",t=p+y.formAllW,s=y.relatH-n,y.drawfun=y.arg.proportional[0]?y.setHtrue:y.setWHfalse,y.PointerShape("ne-resize");break;case"Topleft":w=x=-1,v="LL",u="TT",t=p+y.formAllW,s=n+y.formAllH,y.drawfun=y.arg.proportional[0]?y.setHtrue:y.setWHfalse,y.PointerShape("nw-resize");break;case"Topmiddle":v="ML",k=p,j=y.relatW-k-y.formAllW,t=2*Math.min(k,j)+y.formAllW,u="TT",s=n+y.formAllH,w=-1,y.drawfun=y.arg.proportional[0]?y.setHtrue:y.setHfalse,y.PointerShape("n-resize");break;case"leftmiddle":w=x=-1,t=p+y.formAllW,i=n,h=y.relatH-i-y.formAllH,s=2*Math.min(i,h)+y.formAllH,u="MT",v="LL",y.drawfun=y.arg.proportional[0]?y.setWtrue:y.setWfalse,y.PointerShape("e-resize");break;case"Rightmiddle":t=y.relatW-p,i=n,h=y.relatH-i-y.formAllH,s=2*Math.min(i,h)+y.formAllH,u="MT",y.drawfun=y.arg.proportional[0]?y.setWtrue:y.setWfalse,y.PointerShape("e-resize");break;case"Bottommiddle":k=p,j=y.relatW-k-y.formAllW,t=2*Math.min(k,j)+y.formAllW,s=y.relatH-n,y.drawfun=y.arg.proportional[0]?y.setHtrue:y.setHfalse,v="ML",y.PointerShape("n-resize")}g=b-x*r,f=a-w*q,this.setCapture&&this.setCapture(),"function"==typeof y.DomMoveEve&&y.delEvent(document,y.eveMold[1],y.DomMoveEve),y.DomMoveEve=y.DomMove(y,this,g,f,x,w,o,t,s,v,u),y.addEvent(document,y.eveMold[1],y.DomMoveEve)}else{y.DomUp(this)()}return !1}}},window.ShearPhoto.MINGGE=function(d){function c(){try{document.documentElement.doScroll("left")}catch(a){return setTimeout(c,13),void 0}d()}"function"==typeof d&&(document.addEventListener?document.addEventListener("DOMContentLoaded",d,!1):window.attachEvent?c():alert("MINGGE  ERRO"))},window.ShearPhoto.MoveDiv=function(){this.arg=new Array(),this.ReckonWH=this.DivW=this.DivH=this.selectionempty=this.addevent=this.DivDownEVe=this.DomMoveEve=this.DomUpEve=this.eveMold=!1},window.ShearPhoto.MoveDiv.prototype={ZeroSetting:function(){var k,j=this.HTML5.getLT(this.arg.form),i=parseFloat(j[0]),p=parseFloat(j[1]),o=this._size_(window,!0),n=function(){},m=function(){},l=!1;isNaN(i)||(l=!0,this.HTML5.setL(this.arg.form,0),n=function(b,d){0>b&&(b=0),this_.HTML5.setL(d,i-b+"px")}),isNaN(p)||(l=!0,this.HTML5.setT(this.arg.form,0),m=function(d,c){0>d&&(d=0),this_.HTML5.setT(c,p-d+"px")}),l===!0&&(k=this._size_(window,!0),n(o.W-k.W,this.arg.form),m(o.H-k.H,this.arg.form))},reckon:function(f,e){var h,g;this._size_(f),h=this,e===!0&&(g=function(){h.ZeroSetting(),h._size_(f),h.arg.MoveWidth=h.ReckonWH.W,h.arg.MoveHeight=h.ReckonWH.H,h.SetCenter(h.arg)},this.addEvent(window,"resize",g))},_size_:function(h,g){var l,k,j,i;return h===window?(i={add:document.documentElement,att:document.body}[this.addevent],l=i.clientWidth,k=i.clientHeight,j={W:Math.max(i.scrollWidth,l),H:Math.max(i.scrollHeight,k),CW:l,CH:k}):(l=h.offsetWidth,k=h.offsetHeight,j={W:l,H:k,CW:l,CH:k}),g===!0?j:(this.ReckonWH=j,void 0)},DomUp:function(d){var c=this;return function(){return d.releaseCapture&&d.releaseCapture(),"function"==typeof c.DomMoveEve&&c.delEvent(document,c.eveMold[1],c.DomMoveEve),"function"==typeof c.DomUpEve&&(c.delEvent(document,c.eveMold[2],c.DomUpEve),c.delEvent(window,c.eveMold[2],c.DomUpEve),c.delEvent(window,"blur",c.DomUpEve),c.delEvent(d,"losecapture",c.DomUpEve)),!1}},DivWHFun:function(){this.DivW=this.arg.form.offsetWidth,this.DivH=this.arg.form.offsetHeight},DomMove:function(J,I,H,G){var C,v,u,f,e,x,w,F=J.arg.form,E=J.DivW,D=J.DivH,B=function(){},A=J.arg.shifting="[object Array]"===Object.prototype.toString.call(J.arg.shifting)&&J.arg.shifting.length>1?J.arg.shifting:new Array(0,0),z=J.arg.MoveWidth-A[0],y=J.arg.MoveHeight-A[1];return"function"==typeof J.DomUpEve&&(J.delEvent(document,J.eveMold[2],J.DomUpEve),J.delEvent(window,J.eveMold[2],J.DomUpEve),J.delEvent(window,"blur",J.DomUpEve),J.delEvent(I,"losecapture",J.DomUpEve)),J.DomUpEve=J.DomUp(I),J.addEvent(document,J.eveMold[2],J.DomUpEve),J.addEvent(window,J.eveMold[2],J.DomUpEve),J.addEvent(window,"blur",J.DomUpEve),J.addEvent(I,"losecapture",J.DomUpEve),x=z-E,w=y-D,"function"==typeof J.arg.MoveFun&&(B=J.arg.MoveFun),C=[x,w],function(a){return a=a||window.event,a.button>1?(J.DomUp(this)(),!1):(f=J.eveMold[3](a,"clientX"),e=J.eveMold[3](a,"clientY"),setTimeout(function(){v=f-H,u=e-G,J.selectionempty(),v=v<-A[0]?-A[0]:v,v=v>x?x:v,u=u<-A[1]?-A[1]:u,u=u>w?w:u,J.HTML5.setLT(F,v+"px",u+"px"),B(v,u,C)},1),!1)}},DivDown:function(){var b=this;return function(t){var q,p,s,r,o,n,m,l,a;return t=t||window.event,s=t.button,r=typeof s,t.preventDefault&&t.preventDefault(),"number"!==r?(b.eveMold=["touchstart","touchmove","touchend",function(d,c){return d.touches[0][c]}],q=t.touches[0].clientX,p=t.touches[0].clientY):(b.eveMold=["mousedown","mousemove","mouseup",function(d,c){return d[c]}],q=t.clientX,p=t.clientY),2>s||"number"!==r?(o=b.HTML5.getLT(b.arg.form),n=parseFloat(o[0]),m=parseFloat(o[1]),l=q-n,a=p-m,this.setCapture&&this.setCapture(),"function"==typeof b.arg.DivDownFun&&b.arg.DivDownFun(b),"function"==typeof b.DomMoveEve&&b.delEvent(document,b.eveMold[1],b.DomMoveEve),b.DomMoveEve=b.DomMove(b,this,l,a,n,m),b.addEvent(document,b.eveMold[1],b.DomMoveEve)):b.DomUp(this)(),!1}},ShearPhotoDown:function(d,c){this.addEvent(d,"mousedown",c),this.addEvent(d,"touchstart",c)},delShearPhotoDown:function(d,c){this.delEvent(d,"mousedown",c),this.delEvent(d,"touchstart",c)},et:function(){var f,e=this,d=this.arg.cursor||"move";for(e=this,f=0;f<this.arg.to.length;f++){"add"===this.addevent?("function"!=typeof this.DivDownEVe?this.DivDownEVe=this.DivDown():this.delShearPhotoDown(this.arg.to[f],this.DivDownEVe),this.ShearPhotoDown(this.arg.to[f],this.DivDownEVe)):this.arg.to[f].onmousedown=this.DivDown(),this.arg.to[f].style.cursor=d}},delDownEve:function(){for(var b=0;b<this.arg.to.length;b++){"add"===this.addevent&&"function"==typeof this.DivDownEVe&&this.delShearPhotoDown(this.arg.to[b],this.DivDownEVe)}},setdiv:function(i,h,n,m){var l,k,j;"function"==typeof m.centerFront&&(l=m.centerFront(),h=l[0],n=l[1]),k=Math.round((n-this.DivH)/2),k=0>k?0:k,j=Math.round((h-this.DivW)/2),j=0>j?0:j,this.HTML5.setLT(i,j+"px",k+"px"),"function"==typeof m.centerfun&&m.centerfun(j,k,this)},addEvent:function(f,e,h){var g={add:function(){f.addEventListener(e,h,!1)},att:function(){f.attachEvent("on"+e,h)}};g[this.addevent]&&g[this.addevent]()},delEvent:function(f,e,h){var g={add:function(){f.removeEventListener(e,h,!1)},att:function(){f.detachEvent("on"+e,h)}};g[this.addevent]&&g[this.addevent]()},SetCenter:function(f){var e,h,g;f.center&&(1===f.center?(e=this.ReckonWH.CW,h=this.ReckonWH.CH):(g=this._size_(f.center,!0),e=g.CW,h=g.CH),this.setdiv(f.form,e,h,f))},run:function(b){this.arg=b,this.DivW=b.form.offsetWidth,this.DivH=b.form.offsetHeight,this.SetCenter(b),"number"==typeof b.zIndex&&(b.form.style.zIndex=b.zIndex),this.et()}},window.ShearPhoto.JsonString={_json_:null,JsonToString:function(e){try{this._json_=new Array(),this._read_(e,!0);var d=this._json_.join("");return d=d.replace(/,([\}\]])/g,function(g,c){return c}),this._json_=null,d}catch(f){return alert("\u53d1\u751f\u9519\u8bef\uff0c\u9519\u8bef\u4ee3\u7801--"+f),""}},StringToJson:function(f){var e,h;if("string"!=typeof f){return alert("\u8bf7\u4f20\u5165JSON\u5b57\u4e32\u7b26,\u770b\u6e05\u695ademo.html\u662f\u600e\u4e48\u64cd\u4f5c\u7684"),void 0}try{return e=new Function("return ("+f+")")(),h=this._type_(e),"[object Object]"!==h&&"[object Array]"!==h?(alert("\u4e25\u91cd\u62a5\u9519\uff1a\u540e\u7aef\u6ca1\u8fd4\u56de\u5230JSON\uff0c\u800c\u662f\u4e00\u4e32\u65e0\u6548\u5b57\u7b26\u4e32\u3002\n\n\u4f60\u662f\u5728\u8c03\u8bd5\u5417\uff1f\n\n\u90a3\u4e48\u6309\u786e\u5b9a\uff0c\u67e5\u770b\u90a3\u4e32\u65e0\u6548\u5b57\u7b26\u4e32\u5427"),alert(f),!1):e}catch(g){return alert("\u4e25\u91cd\u62a5\u9519\uff1a\u540e\u7aef\u6ca1\u8fd4\u56de\u5230JSON\uff0c\u800c\u662f\u4e00\u4e32\u65e0\u6548\u5b57\u7b26\u4e32\u3002\n\n\u4f60\u662f\u5728\u8c03\u8bd5\u5417\uff1f\n\n\u90a3\u4e48\u6309\u786e\u5b9a\uff0c\u67e5\u770b\u90a3\u4e32\u65e0\u6548\u5b57\u7b26\u4e32\u5427"),alert(f),!1}},_type_:function(d){if("number"==typeof d.nodeType){return"[object document]"}var c=Object.prototype.toString.call(d);return c},_addjson_:function(f,d,h){var g={"[object Object]":d,"[object Array]":h};this._json_.push(g[f])},_addstring_:function(e){var f,d=typeof e;return"string"===d?'"'+e+'"':"number"===d?e:(f=this._type_(e),"[object Object]"===f||"[object Array]"===f?!1:'""')},_read_:function(g,f){var i,h,j=this._type_(g);if(f&&"[object Object]"!==j&&"[object Array]"!==j){return alert("\u4f60\u4f20\u5165\u4e0d\u662f\u6570\u7ec4\u6216JSON,\u770b\u6e05\u695ademo.html\u662f\u600e\u4e48\u64cd\u4f5c\u7684"),this._json_=null,!1}this._addjson_(j,"{","[",f);for(i in g){"undefined"==typeof g.constructor.prototype[i]&&(h=this._addstring_(g[i]),"boolean"!=typeof h?this._addjson_(j,'"'+i+'":'+h+",",h+","):(this._addjson_(j,'"'+i+'":',""),this._read_(g[i],!1)))}f=f?"":",",this._addjson_(j,"}"+f,"]"+f)}},window.ShearPhoto.MyAjax=function(){this.serverdata=this.erromsg=this.timeout=this.stop=this.xmlhttp=!1,this.transit=!0},window.ShearPhoto.MyAjax.prototype.handle=function(e,d){if(4==e.readyState){if(this.stop===!0){return}if(this.transit=!0,d.timeout&&d.async&&(clearTimeout(this.timeout),this.timeout=!1),200==e.status){var f=this.serverdata=e.responseText.replace(/(^\s*)|(\s*$)/g,"");"function"==typeof d.success&&d.success(f)}else{this.erromsg=e.status,"function"==typeof d.error&&d.error(e.status)}}else{if(0==e.readyState){if(this.stop===!0){return}d.timeout&&d.async&&(clearTimeout(this.timeout),this.timeout=!1),this.erromsg=e.readyState,this.transit=!0,"function"==typeof d.error&&d.error(e.readyState)}}},window.ShearPhoto.MyAjax.prototype.out=function(b){this.transit=!0,this.erromsg=504,this.stop=!0,"function"==typeof b.error&&b.error(504)},window.ShearPhoto.MyAjax.prototype.carry=function(h){var g,l,k,j;if(h.lock&&!this.transit){return !1}this.transit=!1,this.stop=this.erromsg=!1,g=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),h.type=h.type.toUpperCase(),l=function(){},"string"==typeof h.data?(h.data=h.data.replace(/(^\s*)|(\s*$)/g,""),l=function(){g.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}):"[object FormData]"!==Object.prototype.toString.call(h.data)?(h.data="",l=function(){g.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}):("function"==typeof h.progress&&g.upload.addEventListener("progress",h.progress,!1),h.type="POST"),k=""==h.data?[null,""]:[h.data,"?"+h.data],j=this,"function"==typeof h.complete&&h.complete(),h.timeout&&h.async&&(this.timeout=setTimeout(function(){j.out(h)},h.timeout)),h.async===!0&&(g.onreadystatechange=function(){j.handle(g,h)});try{switch(h.type){case"POST":g.open("POST",h.url,h.async),l();break;default:g.open("GET",h.url+k[1],h.async),h.cache===!0||g.setRequestHeader("If-Modified-Since","0")}}catch(i){return this.erromsg=505,h.timeout&&h.async&&(clearTimeout(this.timeout),this.timeout=!1),this.transit=!0,"function"==typeof h.error&&h.error(505),void 0}g.send(k[0]),h.async===!1&&j.handle(g,h)},window.ShearPhoto.frameUpImg=function(d){this.BodyDom=document.body,this.FORM=d.FORM,this.upfile=this.FORM.UpFile,this.config=d,this.upfileclick=!1,"function"!=typeof d.erro&&(d.erro=function(){}),this.FORM.action=d.url;var c=this;this.parentNodes=this.upfile.parentNode,window.attachEvent&&(this.parentNodes.onmousemove=function(){var b=window.event.offsetX+5;0>b&&(b=0),b>224&&(b=224),c.upfile.style.width=b+"px"})},window.ShearPhoto.frameUpImg.prototype={createframe:function(){this.BodyDom.insertAdjacentHTML("afterBegin",'<iframe name="POSTiframe"   class="displayNone"  ></iframe>'),this.iframe=document.getElementsByName("POSTiframe")[0],this.createEve(this.iframe,window.frames.POSTiframe)},createEve:function(e,d){var f=this;this.upfile.files?e.onload=function(){var b,a;e.onload=null,b=d.document.getElementsByTagName("BODY")[0],a=b.innerHTML,f.Evebubbling(a)}:e.onreadystatechange=function(){var b,a;"complete"===e.readyState&&(e.onreadystatechange=null,b=d.document.getElementsByTagName("BODY")[0],a=b.innerHTML,f.Evebubbling(a))}},delframe:function(){this.BodyDom.removeChild(this.iframe),this.DelCreateUpfile()},Evebubbling:function(b){""!=b&&(this.upfile.onclick=this.upfileclick,"function"==typeof this.fun&&this.fun(b),this.delframe())},inArray:function(f,e){if(e.indexOf){return e.indexOf(f)}for(var h=0,g=e.length;g>h;h++){if(e[h]===f){return h}}return -1},DelCreateUpfile:function(){var c,d=this.upfile.onchange;this.upfile.onchange=this.upfile.onclick=null,this.parentNodes.removeChild(this.upfile),c=document.createElement("input"),c.setAttribute("type","file"),c.setAttribute("name","UpFile"),this.parentNodes.appendChild(c),this.upfile=c,this.upfile.onchange=d,this.upfile.onclick=this.upfileclick},Upsubmit:function(g){var f,j,i;try{if(f=g.value.split("."),f="[object Array]"===Object.prototype.toString.call(f)?f[f.length-1]:"",-1==this.inArray(f.toLowerCase(),this.config.UpType)){return this.DelCreateUpfile(),this.config.erro("\u8bf7\u9009\u62e9\u6b63\u786e\u56fe\u7247\u7c7b\u578b"),void 0}if(j=g.files){if(j=j[0],j.type&&(this.config.HTML5.ImagesType=j.type),j.size<=0){return this.DelCreateUpfile(),this.config.erro("\u9519\u8bef\uff1a\u4e0d\u80fd\u9009\u62e9\u7a7a\u5b57\u8282\u6587\u4ef6"),void 0}if(this.config.HTML5.canvas){if(j.size>1024*1024*this.config.HTML5FilesSize){return this.DelCreateUpfile(),this.config.erro("\u9519\u8bef\uff1aHTML5\u4e0a\u4f20\u4e0d\u80fd\u5927\u4e8e"+this.config.HTML5FilesSize+"M"),void 0}}else{if(j.size>1024*1024*this.config.FilesSize){return this.DelCreateUpfile(),this.config.erro("\u9519\u8bef\uff1a\u6587\u4ef6\u4e0d\u80fd\u5927\u4e8e"+this.config.FilesSize+"M"),void 0}}}i=this,"function"==typeof this.config.preced&&this.config.preced(function(){if(i.config.HTML5.canvas){var b=new FileReader();return b.onload=function(){i.DelCreateUpfile(),i.config.HTML5.zipImg(this.result,i.config.HTML5ZIP,j.type,function(a){"function"==typeof i.fun&&i.fun({success:a},!0),delete b})},b.readAsDataURL(j),void 0}i.createframe(),i.FORM.submit()})}catch(h){return this.DelCreateUpfile(),this.config.erro("\u4f60\u9009\u62e9\u4e86\u975e\u56fe\u7247\u7c7b\u578b\uff0c\u6216 \u56fe\u7247\u8def\u5f84\u6709\u8bef"),void 0}},run:function(d){var c=this;this.fun=d,this.upfile.onclick=this.upfileclick=function(){"function"==typeof c.config.fileClick&&c.config.fileClick()},this.upfile.onchange=function(){return""==this.value?!1:(this.onclick=function(){return !1},c.Upsubmit(this),void 0)}}};
